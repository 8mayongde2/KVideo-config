# 🎬 KVideo Config Nexus

本项目是一个集 **API 自动化巡检**、**数据清洗分发** 与 **Cloudflare Workers 递归中转** 于一体的流媒体配置管理方案。



## 🌟 核心功能

* **🔍 自动化质量巡检**：每日自动检测接口连通性、搜索有效性及内容质量，彻底告别“失效源”。
* **🎯 动态优先级系统**：基于 30 天历史数据自动计算 `priority`。稳定源置顶，波动源下沉。
* **📊 状态多级预警**：
    * ✅ **可用**：即时检测正常。
    * ❌ **失联**：当前连接失败。
    * 🚨 **预警**：连续 3 天以上检测失败（可能已宕机或被墙）。
    * 🚫 **禁用**：手动在配置文件中关闭。
* **🛡️ 订阅自动清洗**：
    * `adult.json`：全量接口，异常源自动添加 `_comment` 备注并禁用。
    * `lite.json`：严选版，物理剔除成人组及所有非 ✅ 状态的源。
* **🚀 Workers 递归代理**：内置脚本自动重写 JSON 内的 `baseUrl`，解决资源站跨域与国内直连困难。

---

## 📦 配置源对比

通过在 Worker 链接后添加 `&source=标识符` 参数，可以灵活切换数据集：

| 配置源名称 | 标识符 (`source`) | 映射文件 | 包含成人内容 | 适用场景 |
| :--- | :---: | :--- | :---: | :--- |
| **精简版 (Lite)** | `lite` | `lite.json` | ❌ 否 | 追求极致速度与纯净，剔除失效与成人源 |
| **精简成人版 (Adult)** | `adult` | `adult.json` | ✅ 是 | 包含精简后的常规电影源及成人内容 |
| **完整版 (Full)** | `full` | `KVideo-config.json` | ✅ 是 | 原始备份，包含所有录入的原始数据 |

---

## 🛠️ 文件结构说明

| 文件/目录 | 功能描述 |
| :--- | :--- |
| `KVideo-config.json` | **原始配置**：所有源站数据的录入入口。 |
| `check_api.js` | **巡检核心**：执行测试、计算权重、生成报告与清洗 JSON。 |
| `.github/workflows/` | **Action 配置**：驱动 GitHub 每 24 小时执行一次自动化任务。 |
| `_worker.js` | **中转脚本**：部署在 Cloudflare，提供 UI 界面、KV 缓存及代理转换。 |
| `report.md` | **可视化简报**：直观展示源站地址、趋势及异常备注。 |

---

## 🚀 部署指南

### 1. GitHub 自动化巡检
1.  在 `KVideo-config.json` 中录入你的原始接口列表。
2.  提交 `.github/workflows/build-check-encode.yml` 和 `check_api.js` 到仓库。
3.  GitHub Actions 会在每天北京时间凌晨 1 点自动运行并更新文件。

### 2. Cloudflare Workers 中转
1.  将 `_worker.js` 代码部署到 **Cloudflare Workers**。
2.  **绑定 KV**：在设置中绑定一个名为 `KV` 的命名空间，以启用 600s 缓存提升加载速度。
3.  访问 Workers 域名即可看到可视化导航首页。

---

## 📈 检测标准说明

系统生成的 `report.md` 遵循以下逻辑对资源进行自动分级：

| 标识 | 含义 | 优先级 (Priority) | 处理动作 |
| :---: | :--- | :---: | :--- |
| **✅** | 正常可用 | 1 - 10 | 在 Lite 版中保留 |
| **❌** | 暂时失联 | 100+ | Lite 版自动剔除 |
| **🚨** | 持续宕机 (3天+) | 200+ | 标注 `_comment` 并提醒手动检查 |
| **🚫** | 手动禁用 | 999 | 仅在 Full 版中保留，排名垫底 |

---

## 🔗 快速调用示例

* **获取最稳的精简订阅（带代理中转）：** `https://你的域名.workers.dev/?format=1&source=lite`
* **获取原始链接的成人版订阅（无代理）：** `https://你的域名.workers.dev/?format=0&source=adult`

---

**最近巡检报告请查看：[report.md](./report.md)**
